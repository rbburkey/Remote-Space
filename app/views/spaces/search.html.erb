<div class="page-wrapper">
  <div id="page-content">
    <div class="container">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/spaces">Spaces</a></li>
        <li class="active">Search</li>
      </ol>

      <section class="page-title">
        <h1>Search Results</h1>
      </section>
      <!--end section-title-->



      <section>
        <div class="search-results-controls clearfix">
          <div class="pull-left">
            <a href="" class="circle-icon active"><i class="fa fa-map"></i></a>
          </div>
          <!--end left-->
          <!-- <div class="pull-right">
            <div class="input-group inputs-underline min-width-150px">
              <select class="form-control selectpicker" name="sort">
                <option value="">Sort by</option>
                <option value="1">Price</option>
                <option value="2">Distance</option>
                <option value="3">Title</option>
              </select>
            </div>
          </div> -->
          <!--end right-->
        </div>
        <!--end search-results-controls-->
      </section>
      <section>

        <section>
        <div style='width: 100%;' id="show_map">
            <div class="map" id="map" style='width: 100%; height: 500px;'></div>
        </div>
      </section>


        <div class="row">
          <% @spaces.each do |space| %>
          <div class="col-md-4 col-sm-4">
            <div class="item" data-id="1">
              <span>
                <%=image_tag space.image.url(:large), class: "image" %>
                <div class="description">
                  <div class="label label-default"><%= "#{space.category.name}"%></div>
                  <h3 style="margin-top: 5px; margin-bottom: 5px;"><%= link_to "#{space.name}", space_path(space), style: "color: white; text-shadow: 0px 1px 1px rgba(0, 0, 0, 0.5);"  %></h3>
                  <h4 style="margin: 0;"><%=space.city%>, <%=space.state.upcase%></h4>
                </div>
                <!--end description-->



              </span>
              <!--end image-->
              <div class="additional-info">
                <div class="rating-passive" data-rating=<%=@spaces[-1].reviews.average(:rating)%>>
                  <div id="star"></div>
                  <% if space.reviews.average(:rating) == nil %>
                  <span class="reviews"><%= link_to "Be the first to Review!", space%></span>
                  <%else%>
                  <span class="reviews"><%=space.reviews.average(:rating)%></span>
                  <span class="star-rating" data-score=<%=@spaces[-1].reviews.average(:rating)%> ></span>
                  <%end%>
                  <% if current_user %>
                  <% if current_user.favorites.include? space %>
                  <div class="fav_button" style="float: right;">
                    <%= link_to "Unfavorite", favorite_space_path(space, type: "unfavorite"), class: "btn btn-primary btn-rounded btn-xs", method: :put %>
                  </div>
                  <%elsif current_user%>
                  <div class="fav_button" style="float: right;">
                    <%= link_to "Favorite", favorite_space_path(space, type: "favorite"), class: "btn btn-primary btn-rounded btn-xs", method: :put %>
                  </div>
                  <% end %>
                  <%else%>
                  <div class="fav_button" style="float: right;">
                    <%= link_to "Favorite", favorite_space_path(space, type: "favorite"), class: "btn btn-primary btn-rounded btn-xs", method: :put %>
                  </div>
                  <%end%>


                </div>

                <!--end controls-more-->
              </div>
              <!--end additional-info-->
              <!--end item-->

            </div>
          </div>
          <%end%>
          <!--<end col-md-3-->
        </div>
        <!--end row-->

      </section>
      <section>
        <div class="center">
          <nav aria-label="Page navigation">
            <ul class="pagination">
              <%= will_paginate @spaces %>
            </ul>
          </nav>
        </div>
      </section>


    </div>
    <!--end container-->
  </div>
</div>
<!--end page-content-->
<!--end page-wrapper-->
<a href="#page-header" class="to-top scroll" data-show-after-scroll="600"><i class="arrow_up"></i></a>

<script>
$('.star-rating').raty({
  path: '/assets',
  readOnly: true,
  score: function() {
    return $(this).attr('data-score');
  }
});
</script>


<script src="//maps.google.com/maps/api/js?key=AIzaSyDrG6_o9uHuGiIPiOipNnsZj_Jbizir93w"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<script type="text/javascript">
handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>

<script type="text/javascript">
$(function() {
  $('.circle-icon').click(function(event){
    event.preventDefault();
    $('#map').toggle();
  });
});
</script>
